(this["webpackJsonpfront-apollo"]=this["webpackJsonpfront-apollo"]||[]).push([[0],{112:function(e,n,t){},120:function(e,n,t){"use strict";t.r(n),t.d(n,"client",(function(){return ee}));var a=t(78),r=t(1),c=t.n(r),i=t(23),o=t(90),l=t(91),u=t(87),s=t.n(u),m=(t(112),t(11)),d=t(89),p=t(24),f=t(19),v=t(20),b=t(84);function g(){var e=Object(p.a)(["\n  mutation VoteMutation($linkId: ID!) {\n    vote(linkId: $linkId) {\n      id\n      link {\n        id\n        votes {\n          id\n          user {\n            id\n          }\n        }\n      }\n      user {\n        id\n      }\n    }\n  }\n"]);return g=function(){return e},e}var h=Object(v.a)(g()),k=function(e){var n=localStorage.getItem("auth-token"),t=Object(b.a)(h),a=Object(f.a)(t,2),r=a[0],i=a[1],o=i.loading,l=i.error;return o?c.a.createElement("p",null,"loading votes..."):l?c.a.createElement("p",null,"An error occurred on votes mutation"):c.a.createElement("div",{className:"flex mt2 items-start"},c.a.createElement("div",{className:"flex items-center"},c.a.createElement("span",{className:"gray"},e.index+1,"."),n&&c.a.createElement("div",{className:"ml1 gray f11",onClick:function(){return r({variables:{linkId:e.link.id}})}},"\u25b2")),c.a.createElement("div",{className:"ml1"},c.a.createElement("div",null,e.link.description," (",e.link.url,")"),c.a.createElement("div",{className:"f6 lh-copy gray"},e.link.votes.length," votes | by"," ",e.link.postedBy?e.link.postedBy.name:"Unknown"," ")))},E=t(83);function j(){var e=Object(p.a)(["\n  subscription {\n    newVote {\n      id\n      link {\n        id\n        url\n        description\n        postedBy {\n          id\n          name\n        }\n        votes {\n          id\n          user {\n            id\n          }\n        }\n      }\n      user {\n        id\n      }\n    }\n  }\n"]);return j=function(){return e},e}function O(){var e=Object(p.a)(["\n  subscription {\n    newLink {\n      id\n      url\n      description\n      postedBy {\n        id\n        name\n      }\n      votes {\n        id\n        user {\n          id\n        }\n      }\n    }\n  }\n"]);return O=function(){return e},e}function y(){var e=Object(p.a)(["\n  query FeedQuery {\n    feed {\n      links {\n        id\n        # createdAt\n        # agregar en el backend el campo created at \n        url\n        description\n        postedBy {\n          id\n          name\n        }\n        votes {\n          id\n          user {\n            id\n          }\n        }\n      }\n      count\n    }\n  }\n"]);return y=function(){return e},e}var w=Object(v.a)(y()),x=Object(v.a)(O()),N=Object(v.a)(j()),S=function(e){var n=function(n,t,a){var r=e.location.pathname.includes("new"),c=parseInt(e.match.params.page,10),i=r?5*(c-1):0,o=r?5:100,l=r?"createdAt_DESC":null,u=n.readQuery({query:w,variables:{first:o,skip:i,orderBy:l}});u.feed.links.find((function(e){return e.id===a})).votes=t.link.votes,n.writeQuery({query:w,data:u})},t=Object(m.g)(),a=Object(E.a)(w,{variables:{skip:e.location.pathname.includes("new")?5*(parseInt(e.match.params.page,10)-1):0,first:e.location.pathname.includes("new")?5:100,orderBy:e.location.pathname.includes("new")?"createdAt_DESC":null}}),r=a.loading,i=a.error,o=a.data,l=a.subscribeToMore;if(r)return"Loading...";if(i)return"Error! ".concat(i.message);!function(e){e({document:x,updateQuery:function(e,n){var t=n.subscriptionData;if(!t.data)return e;var a=t.data.newLink;return e.feed.links.find((function(e){return e.id===a.id}))?e:Object.assign({},e,{feed:{links:[a].concat(Object(d.a)(e.feed.links)),count:e.feed.links.length+1,__typename:e.feed.__typename}})}})}(l),function(e){e({document:N})}(l);var u=function(n){if(e.location.pathname.includes("new"))return n.feed.links;var t=n.feed.links.slice();return t.sort((function(e,n){return n.votes.length-e.votes.length})),t}(o),s=e.location.pathname.includes("new"),p=e.match.params.page?5*(e.match.params.page-1):0;return c.a.createElement(c.a.Fragment,null,u.map((function(e,t){return c.a.createElement(k,{key:e.id,link:e,index:t+p,updateStoreAfterVote:n})})),s&&c.a.createElement("div",{className:"flex ml4 mv3 gray"},c.a.createElement("div",{className:"pointer mr2",onClick:function(){var n=parseInt(e.match.params.page,10);if(n>1){var a=n-1;t.push("/new/".concat(a))}}},"Previous"),c.a.createElement("div",{className:"pointer",onClick:function(){return function(n){var a=parseInt(e.match.params.page,10);if(a<=n.feed.count/5){var r=a+1;t.push("/new/".concat(r))}}(o)}},"Next")))};function C(){var e=Object(p.a)(["\n  mutation PostMutation($description: String!, $url: String!) {\n    post(description: $description, url: $url) {\n      id\n      url\n      description\n    }\n  }\n"]);return C=function(){return e},e}var $=Object(v.a)(C()),I=function(){var e=Object(m.g)(),n=Object(r.useState)(""),t=Object(f.a)(n,2),a=t[0],i=t[1],o=Object(r.useState)(""),l=Object(f.a)(o,2),u=l[0],s=l[1],d=Object(b.a)($,{onCompleted:function(n){n.updatePostMutation;e.push("/new/1")},update:function(e,n){var t=n.data.post,a=e.readQuery({query:w,variables:{first:5,skip:0,orderBy:"createdAt_DESC"}});a.feed.links.unshift(t),e.writeQuery({query:w,data:a,variables:{first:5,skip:0,orderBy:"createdAt_DESC"}})}}),p=Object(f.a)(d,2),v=p[0],g=p[1],h=g.loading,k=g.error;return h?c.a.createElement("p",null,"loading..."):k?c.a.createElement("p",null,"An error occurred"):c.a.createElement("div",null,c.a.createElement("div",{className:"flex flex-column mt3"},c.a.createElement("input",{className:"mb2",value:a,onChange:function(e){return i(e.target.value)},type:"text",placeholder:"A description for the link"}),c.a.createElement("input",{className:"mb2",value:u,onChange:function(e){return s(e.target.value)},type:"text",placeholder:"The URL for the link"})),c.a.createElement("button",{onClick:function(){return v({variables:{description:a,url:u}})}},"Submit"))},B=Object(m.h)((function(){var e=localStorage.getItem("auth-token"),n=Object(m.g)();return c.a.createElement("div",{className:"flex pa1 justify-between nowrap orange"},c.a.createElement("div",{className:"flex flex-fixed black"},c.a.createElement("div",{className:"fw7 mr1"},"Hacker News"),c.a.createElement(i.b,{to:"/",className:"ml1 no-underline black"},"new"),c.a.createElement("div",{className:"ml1"},"|"),c.a.createElement(i.b,{to:"/top",className:"ml1 no-underline black"},"top"),c.a.createElement("div",{className:"ml1"},"|"),c.a.createElement(i.b,{to:"/search",className:"ml1 no-underline black"},"search"),e&&c.a.createElement("div",{className:"flex"},c.a.createElement("div",{className:"ml1"},"|"),c.a.createElement(i.b,{to:"/create",className:"ml1 no-underline black"},"submit"))),c.a.createElement("div",{className:"flex flex-fixed"},e?c.a.createElement("div",{className:"ml1 pointer black",onClick:function(){localStorage.removeItem("auth-token"),n.push("/")}},"logout"):c.a.createElement(i.b,{to:"/login",className:"ml1 no-underline black"},"login")))})),A=t(54),q=t.n(A),D=t(65);function _(){var e=Object(p.a)(["\n  mutation LoginMutation($email: String!, $password: String!) {\n    login(email: $email, password: $password) {\n      token\n    }\n  }\n"]);return _=function(){return e},e}function Q(){var e=Object(p.a)(["\n  mutation SignupMutation($email: String!, $password: String!, $name: String!) {\n    signup(email: $email, password: $password, name: $name) {\n      token\n    }\n  }\n"]);return Q=function(){return e},e}var L=Object(v.a)(Q()),M=Object(v.a)(_()),P=function(){var e=Object(m.g)(),n=Object(r.useState)(!0),t=Object(f.a)(n,2),a=t[0],i=t[1],o=Object(r.useState)(""),l=Object(f.a)(o,2),u=l[0],s=l[1],d=Object(r.useState)(""),p=Object(f.a)(d,2),v=p[0],g=p[1],h=Object(r.useState)(""),k=Object(f.a)(h,2),E=k[0],j=k[1],O=function(e){localStorage.setItem("auth-token",e)},y=function(){var n=Object(D.a)(q.a.mark((function n(t){var r,c;return q.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=a?t.login:t.signup,c=r.token,O(c),e.push("/");case 3:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),w=Object(b.a)(a?M:L,{onCompleted:function(e){y(e)}}),x=Object(f.a)(w,2),N=x[0],S=x[1],C=S.loading,$=S.error;if(C)return c.a.createElement("p",null,"loading access...");if($)return c.a.createElement("p",null,"An error occurred on access");return c.a.createElement("div",null,c.a.createElement("h4",{className:"mv3"},a?"Login":"Sign Up"),c.a.createElement("div",{className:"flex flex-column"},!a&&c.a.createElement("input",{value:E,onChange:function(e){return j(e.target.value)},type:"text",placeholder:"Your name"}),c.a.createElement("input",{value:u,onChange:function(e){return s(e.target.value)},type:"text",placeholder:"Your email address"}),c.a.createElement("input",{value:v,onChange:function(e){return g(e.target.value)},type:"password",placeholder:"Choose a safe password"})),c.a.createElement("div",{className:"flex mt3"},c.a.createElement("div",{className:"pointer mr2 button",onClick:function(){return N({variables:{email:u,password:v,name:E}})}},a?"login":"create account"),c.a.createElement("div",{className:"pointer button",onClick:function(e){return function(e){e.preventDefault(),i((function(e){return!e}))}(e)}},a?"need to create an account?":"already have an account?")))};function F(){var e=Object(p.a)(["\n  query FeedSearchQuery($filter: String!) {\n    feed(filter: $filter) {\n      links {\n        id\n        url\n        description\n        postedBy {\n          id\n          name\n        }\n        votes {\n          id\n          user {\n            id\n          }\n        }\n      }\n    }\n  }\n"]);return F=function(){return e},e}var T=Object(v.a)(F()),U=function(e){var n=Object(r.useState)([]),t=Object(f.a)(n,2),a=t[0],i=t[1],o=Object(r.useState)(""),l=Object(f.a)(o,2),u=l[0],s=l[1],m=function(){var e=Object(D.a)(q.a.mark((function e(){var n,t;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ee.query({query:T,variables:{filter:u}});case 2:n=e.sent,t=n.data.feed.links,i(t);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return c.a.createElement("div",null,c.a.createElement("div",null,"Search",c.a.createElement("input",{type:"text",onChange:function(e){return s(e.target.value)}}),c.a.createElement("button",{onClick:function(){return m()}},"OK")),a.map((function(e,n){return c.a.createElement(k,{key:e.id,link:e,index:n})})))};var V=function(){return c.a.createElement("div",{className:"center w85"},c.a.createElement(B,null),c.a.createElement("div",{className:"ph3 pv1 background-gray"},c.a.createElement(m.d,null,c.a.createElement(m.b,{exact:!0,path:"/",render:function(){return c.a.createElement(m.a,{to:"/new/1"})}}),c.a.createElement(m.b,{exact:!0,path:"/create",component:I}),c.a.createElement(m.b,{exact:!0,path:"/login",component:P}),c.a.createElement(m.b,{exact:!0,path:"/search",component:U}),c.a.createElement(m.b,{exact:!0,path:"/top",component:S}),c.a.createElement(m.b,{exact:!0,path:"/new/:page",component:S}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var J=t(92),W=t(48),Y=t(58),z=t(59),H=t(60),K=t(82),R=Object(W.a)({uri:"https://backend-josue.herokuapp.com/",onError:function(e){console.log(e)}}),G=Object(o.a)((function(e,n){var t=n.headers,r=localStorage.getItem("auth-token");return{headers:Object(a.a)(Object(a.a)({},t),{},{authorization:r?"Bearer ".concat(r):""})}})),X=new l.a({uri:"ws://backend-josue.herokuapp.com/",options:{reconnect:!0,connectionParams:{authToken:localStorage.getItem("auth-token")}}}),Z=Object(Y.a)((function(e){var n=e.query,t=Object(J.a)(n),a=t.kind,r=t.operation;return"OperationDefinition"===a&&"subscription"===r}),X,G.concat(R)),ee=new z.a({link:Z,cache:new H.a});s.a.render(c.a.createElement(i.a,null,c.a.createElement(K.a,{client:ee},c.a.createElement(V,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},97:function(e,n,t){e.exports=t(120)}},[[97,1,2]]]);
//# sourceMappingURL=main.cae9a8b7.chunk.js.map